{% extends "base.html" %}
{% block title %}Cono perfecto ‚Äî m√©todo anal√≠tico{% endblock %}

{% block head %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<!-- MathJax para renderizado LaTeX -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  .code-wrap{
    background:#0b1020;color:#e5e7eb;border-radius:10px;padding:1rem 1.25rem;
    border:1px solid #111827;overflow-x:auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    line-height:1.45; position: relative;
  }
  .tt{
    cursor:help; text-decoration: underline dotted;
    border-bottom: 1px dotted #60a5fa; color: #93c5fd;
  }
  .tt:hover { color: #bfdbfe; }
  .lead-note{ font-size:.95rem; color:#4b5563; }
  .param-grid{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
  .param-grid .full{ grid-column: 1 / -1; }
  .copy-btn{
    position:absolute; top:8px; right:8px; font-size:.85rem;
    background:#111827; color:#e5e7eb; border:1px solid #374151; border-radius:6px; padding:.25rem .5rem;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // ---------- Tooltips con LaTeX ----------
  const initTooltips = () => {
    const tips = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tips.forEach((el) => {
      new bootstrap.Tooltip(el, {
        html: true,
        trigger: 'hover focus',
        sanitize: false,
        container: 'body',
        customClass: 'math-tooltip',
        delay: { show: 300, hide: 100 }
      });
      el.addEventListener('shown.bs.tooltip', () => {
        const id = el.getAttribute('aria-describedby');
        const tip = id && document.getElementById(id);
        if (tip && window.MathJax && MathJax.typesetPromise) {
          const inner = tip.querySelector('.tooltip-inner');
          if (inner) MathJax.typesetPromise([inner]).catch(() => {});
        }
      });
    });
  };

  // ---------- Par√°metros (inputs) ----------
  const aEl  = document.getElementById('parama');
  const gEl  = document.getElementById('paramg');
  const h0El = document.getElementById('paramh0');
  const R0El = document.getElementById('paramR0');
  const HEl  = document.getElementById('paramH');
  const nEl  = document.getElementById('paramN');
  const tvacOut = document.getElementById('tvac');

  // ---------- Modelo anal√≠tico (cono perfecto) ----------
  function computeSeries(a, g, h0, R0, H, N=600){
    const C = (a * H*H) / (Math.PI * R0*R0) * Math.sqrt(2*g);
    const T = (2/(5*C)) * Math.pow(h0, 2.5);
    const t = [], y = [];
    for (let i=0; i<N; i++){
      const ti = i * T / (N-1);
      const inside = Math.max(Math.pow(h0, 2.5) - (5/2)*C*ti, 0);
      const hi = Math.pow(inside, 2/5);
      t.push(ti);
      y.push(hi);
    }
    return {t, y, T};
  }

  // ---------- Gr√°fico ----------
  const ctx = document.getElementById('chart').getContext('2d');
  let chart;

  function updateChart(a, g, h0, R0, H, N){
    const {t, y, T} = computeSeries(a, g, h0, R0, H, N);
    tvacOut.textContent = T.toFixed(4) + ' s';

    const points = t.map((ti, i) => ({ x: ti, y: y[i] }));

    if (!chart){
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [{
            label: 'h(t)',
            data: points,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59,130,246,0.1)',
            borderWidth: 2,
            tension: 0.1,
            fill: true,
            pointRadius: 0,
            pointHoverRadius: 4
          }]
        },
        options: {
          parsing: false,
          animation: { duration: 0 },
          responsive: true,
          interaction: { intersect: false, mode: 'index' },
          scales: {
            x: {
              type: 'linear',
              title: { display: true, text: 't (s)', color: '#6b7280', font: { size: 12 } },
              grid: { color: 'rgba(0,0,0,0.06)', drawBorder: false },
              ticks: { color: '#9ca3af', maxTicksLimit: 8 }
            },
            y: {
              title: { display: true, text: 'h(t) (m)', color: '#6b7280', font: { size: 12 } },
              suggestedMin: 0,
              suggestedMax: Math.max(1, h0),
              grid: { color: 'rgba(0,0,0,0.06)', drawBorder: false },
              ticks: { color: '#9ca3af', maxTicksLimit: 6 }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    } else {
      chart.data.datasets[0].data = points;
      chart.options.scales.y.suggestedMax = Math.max(1, h0);
      chart.update();
    }
  }

  // ---------- C√≥digo Python "vivo" con tooltips MEJORADOS ----------
  const codeEl = document.getElementById('code-block');

  function renderCode(a, g, h0, R0, H){
    const a_txt = a.toExponential(6);
    const g_txt = g.toPrecision(6);
    const h0_txt = h0.toPrecision(6);
    const R0_txt = R0.toPrecision(6);
    const H_txt  = H.toPrecision(6);

    const codeHtml = `
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>NUMPY - C√ÅLCULO NUM√âRICO</strong><br><br>Librer√≠a fundamental para operaciones matem√°ticas y manejo de arrays en Python.<br><br>Nos permite trabajar con vectores de tiempo y evaluar funciones vectorialmente.">
import numpy as <b>np</b></span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>MATPLOTLIB - VISUALIZACI√ìN</strong><br><br>Librer√≠a est√°ndar para creaci√≥n de gr√°ficos y visualizaciones cient√≠ficas.<br><br>Usaremos <code>pyplot</code> para generar el gr√°fico de h(t) vs t.">
import matplotlib.pyplot as <b>plt</b></span>

# par√°metros del sistema (cono perfecto)
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>√ÅREA DEL ORIFICIO (a)</strong><br><br>\\[ a = ${a}\\,\\mathrm{m}^2 \\]<br><br>Representa el √°rea de la secci√≥n de salida del fluido.<br><br><strong>Relaci√≥n f√≠sica:</strong> Determina el caudal de salida seg√∫n Torricelli:<br>\\[ Q = a \\cdot v = a \\sqrt{2gh} \\]">
a   = ${a_txt}   # m¬≤</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>ACELERACI√ìN GRAVITACIONAL (g)</strong><br><br>\\[ g = ${g}\\,\\mathrm{m/s^2} \\]<br><br>Aceleraci√≥n debida a la gravedad que impulsa el flujo.<br><br><strong>En Torricelli:</strong> \\[ v = \\sqrt{2gh} \\]<br>La velocidad de salida depende de la ra√≠z cuadrada de g.">
g   = ${g_txt}   # m/s¬≤</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>ALTURA INICIAL (h‚ÇÄ)</strong><br><br>\\[ h_0 = ${h0}\\,\\mathrm{m} \\]<br><br>Altura inicial del fluido en el cono.<br><br><strong>Importancia:</strong> Aparece elevada a 2.5 en la soluci√≥n, lo que refleja la no-linealidad del sistema.">
h0  = ${h0_txt}  # m</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>RADIO DE LA BOCA (R‚ÇÄ)</strong><br><br>\\[ R_0 = ${R0}\\,\\mathrm{m} \\]<br><br>Radio del cono a la altura H (parte superior).<br><br><strong>En geometr√≠a:</strong> El radio a cualquier altura h es:<br>\\[ R(h) = \\frac{R_0}{H} h \\]">
R0  = ${R0_txt}  # m</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>ALTURA TOTAL DEL CONO (H)</strong><br><br>\\[ H = ${H}\\,\\mathrm{m} \\]<br><br>Altura total del cono desde el v√©rtice hasta la boca.<br><br><strong>Relaci√≥n geom√©trica:</strong> Define la pendiente del cono:<br>\\[ \\frac{R_0}{H} = \\text{pendiente del radio} \\]">
H   = ${H_txt}   # m</span>

<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>FUNCI√ìN DE LA SOLUCI√ìN ANAL√çTICA</strong><br><br><strong>Geometr√≠a del cono:</strong><br>\\[ A(h) = \\pi \\left(\\frac{R_0}{H}\\right)^2 h^2 \\]<br><br><strong>Constante C (tasa de vaciado):</strong><br>\\[ C = \\frac{aH^2}{\\pi R_0^2}\\sqrt{2g} \\]<br><br><strong>Origen de C:</strong> Surge al separar variables en la ecuaci√≥n diferencial:<br>\\[ A(h) \\frac{dh}{dt} = -a\\sqrt{2gh} \\]">
def h_cono_anal(h0, a, R0, H, t, g=9.8):</span>
    t = np.asarray(t)
    <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
      data-bs-title="<strong>CONSTANTE C - EXPLICACI√ìN DETALLADA</strong><br><br>\\[ C = \\frac{aH^2}{\\pi R_0^2}\\sqrt{2g} \\]<br><br><strong>Desglose de t√©rminos:</strong><br>‚Ä¢ \\[a\\] - √°rea del orificio (controla el caudal)<br>‚Ä¢ \\[H^2/R_0^2\\] - relaci√≥n geom√©trica del cono<br>‚Ä¢ \\[\\sqrt{2g}\\] - factor de Torricelli para la velocidad<br><br><strong>Significado f√≠sico:</strong> C representa la <em>tasa efectiva de vaciado</em> del cono. Un C mayor significa vaciado m√°s r√°pido.">
    C = (a*H**2)/(np.pi*R0**2) * np.sqrt(2*g)</span>
    <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
      data-bs-title="<strong>N√öCLEO DE LA SOLUCI√ìN ANAL√çTICA</strong><br><br>\\[ \\text{inside} = h_0^{5/2} - \\frac{5}{2}C t \\]<br><br><strong>Origen matem√°tico:</strong> Viene de integrar la ecuaci√≥n diferencial:<br>\\[ \\int h^{3/2} dh = -C \\int dt \\]<br>\\[ \\frac{2}{5}h^{5/2} = -C t + \\text{constante} \\]<br><br>El <code>np.maximum(..., 0)</code> asegura que la altura nunca sea negativa.">
    inside = np.maximum(h0**2.5 - (5/2)*C*t, 0.0)</span>
    <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
      data-bs-title="<strong>FORMA FINAL DE LA SOLUCI√ìN</strong><br><br>\\[ h(t) = \\left[ h_0^{5/2} - \\frac{5}{2}C t \\right]^{2/5} \\]<br><br><strong>Explicaci√≥n de exponentes:</strong><br>‚Ä¢ <strong>5/2:</strong> Viene de integrar h¬≥/¬≤ dh<br>‚Ä¢ <strong>2/5:</strong> Es el inverso de 5/2 para despejar h(t)<br><br>Esta es la <em>soluci√≥n exacta cerrada</em> para el cono perfecto.">
    return inside**(2/5)</span>

<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>TIEMPO DE VACIADO COMPLETO - DEDUCCI√ìN</strong><br><br>Cuando \\[h(T) = 0\\]:<br>\\[ 0 = \\left( h_0^{5/2} - \\frac{5}{2}C T \\right)^{2/5} \\]<br>\\[ h_0^{5/2} = \\frac{5}{2}C T \\]<br>\\[ T = \\frac{2}{5C} h_0^{5/2} \\]<br><br><strong>Sustituyendo C:</strong><br>\\[ T = \\frac{2\\pi R_0^2}{5aH^2\\sqrt{2g}} h_0^{2.5} \\]<br><br>Nota: \\[h_0^{5/2} = h_0^{2.5}\\]]">
T = (2*np.pi*R0**2/(5*a*H**2*np.sqrt(2*g))) * h0**2.5</span>
print("T ‚âà", T, "s")

# malla temporal y evaluaci√≥n
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>CREACI√ìN DE MALLA TEMPORAL</strong><br><br>Generamos 600 puntos equidistantes desde t=0 hasta t=T.<br><br><strong>Prop√≥sito:</strong> Discretizar el tiempo para evaluar la funci√≥n h(t) en m√∫ltiples puntos y poder graficar la curva continua.">
t_anal = np.linspace(0, T, 600)</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>EVALUACI√ìN VECTORIAL DE LA SOLUCI√ìN</strong><br><br>Aprovechamos que NumPy permite evaluar funciones sobre arrays completos.<br><br><strong>Ventaja:</strong> En lugar de un bucle, evaluamos todos los puntos de tiempo simult√°neamente, lo que es computacionalmente eficiente.">
y_anal = h_cono_anal(h0, a, R0, H, t_anal, g)</span>

# visualizaci√≥n
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>GR√ÅFICO DE LA SOLUCI√ìN</strong><br><br>Crear el gr√°fico principal con:<br>‚Ä¢ <strong>L√≠nea azul:</strong> Representa la soluci√≥n anal√≠tica exacta<br>‚Ä¢ <strong>Linewidth=2:</strong> Grosor de l√≠nea para buena visibilidad<br>‚Ä¢ <strong>Label:</strong> Para la leyenda<br><br>Esta curva muestra c√≥mo decae la altura del fluido de forma no-lineal.">
plt.plot(t_anal, y_anal, color='blue', linewidth=2, label='Cono perfecto (anal√≠tica)')</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>CONFIGURACI√ìN DEL EJE Y</strong><br><br>Fijamos los l√≠mites del eje Y para mejor visualizaci√≥n:<br>‚Ä¢ <strong>L√≠mite inferior:</strong> 0 (altura m√≠nima)<br>‚Ä¢ <strong>L√≠mite superior:</strong> m√°ximo entre 1 y h‚ÇÄ<br><br>Esto asegura que siempre veamos todo el rango relevante de alturas.">
plt.ylim(0, max(1, h0))</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>ETIQUETAS DE EJES</strong><br><br>Etiquetas claras para ambos ejes:<br>‚Ä¢ <strong>Eje X:</strong> Tiempo en segundos<br>‚Ä¢ <strong>Eje Y:</strong> Altura en metros<br><br>Buenas pr√°cticas de visualizaci√≥n cient√≠fica requieren unidades expl√≠citas.">
plt.xlabel("Tiempo t (s)"); plt.ylabel("Altura h(t) (m)")</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>T√çTULO INFORMATIVO</strong><br><br>El t√≠tulo debe describir claramente:<br>‚Ä¢ Qu√© sistema se modela (cono perfecto)<br>‚Ä¢ Qu√© tipo de soluci√≥n se muestra (anal√≠tica)<br>‚Ä¢ Qu√© fen√≥meno se estudia (vaciado)<br><br>Ayuda al espectador a entender r√°pidamente el contexto.">
plt.title("Vaciado en cono perfecto ‚Äî soluci√≥n anal√≠tica")</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>CUADr√çCULA PARA MEJOR LECTURA</strong><br><br>La cuadr√≠cula ayuda a:<br>‚Ä¢ Leer valores aproximados del gr√°fico<br>‚Ä¢ Seguir la evoluci√≥n temporal<br>‚Ä¢ Identificar puntos caracter√≠sticos<br><br>Alpha=0.3 la hace visible pero no intrusiva.">
plt.grid(True, alpha=0.3, linestyle='--')</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>LEYENDA EXPLICATIVA</strong><br><br>La leyenda identifica:<br>‚Ä¢ Qu√© representa cada curva (en este caso, una sola)<br>‚Ä¢ El tipo de soluci√≥n (anal√≠tica)<br><br>Esencial cuando hay m√∫ltiples curvas en el mismo gr√°fico.">
plt.legend()</span>
<span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
  data-bs-title="<strong>AJUSTE AUTOM√ÅTICO DEL DISE√ëO</strong><br><br><code>tight_layout()</code> autom√°ticamente:<br>‚Ä¢ Ajusta espaciado entre elementos<br>‚Ä¢ Evita que etiquetas se salgan del √°rea de plotting<br>‚Ä¢ Mejora la est√©tica general<br><br>Buena pr√°ctica siempre incluirla.">
plt.tight_layout()</span>
plt.show()`;

    codeEl.textContent = '';
    codeEl.innerHTML = codeHtml;

    setTimeout(() => {
      initTooltips();
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([codeEl]).catch(() => {});
      }
    }, 100);
  }

  // ---------- Reset ----------
  const resetBtn = document.getElementById('reset');
  const defaults = { a:0.001, g:9.8, h0:1.0, R0:0.4, H:1.0, N:600 };
  resetBtn.addEventListener('click', () => {
    aEl.value  = defaults.a;
    gEl.value  = defaults.g;
    h0El.value = defaults.h0;
    R0El.value = defaults.R0;
    HEl.value  = defaults.H;
    nEl.value  = defaults.N;
    updateAll();
  });

  // ---------- Ciclo de actualizaci√≥n ----------
  function updateAll(){
    const a  = Math.max(1e-12, parseFloat(aEl.value));
    const g  = Math.max(1e-12, parseFloat(gEl.value));
    const h0 = Math.max(0, parseFloat(h0El.value));
    const R0 = Math.max(1e-12, parseFloat(R0El.value));
    const H  = Math.max(1e-12, parseFloat(HEl.value));
    const N  = Math.max(2, parseInt(nEl.value || '600', 10));

    renderCode(a, g, h0, R0, H);
    updateChart(a, g, h0, R0, H, N);
  }

  [aEl, gEl, h0El, R0El, HEl, nEl].forEach(inp => {
    inp.addEventListener('input', updateAll);
    inp.addEventListener('change', updateAll);
  });

  // Copiar c√≥digo
  const copyBtn = document.getElementById('copy');
  copyBtn.addEventListener('click', () => {
    const tmp = document.createElement('textarea');
    tmp.value = codeEl.innerText;
    document.body.appendChild(tmp);
    tmp.select();
    document.execCommand('copy');
    document.body.removeChild(tmp);
    copyBtn.textContent = '¬°Copiado!';
    setTimeout(()=> copyBtn.textContent = 'Copiar c√≥digo', 1200);
  });

  // LaTeX en el MODAL
  const explanationModal = document.getElementById('explicacionModal');
  if (explanationModal){
    explanationModal.addEventListener('shown.bs.modal', () => {
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([explanationModal]).catch(() => {});
      }
    });
  }

  // Inicializaci√≥n
  initTooltips();
  updateAll();
});
</script>
{% endblock %}

{% block content %}
<div class="container">
  <h1 class="h3 mb-2">Cono perfecto ‚Äî m√©todo anal√≠tico con Python</h1>
  <p class="lead-note mb-3">
    Aqu√≠ \(A(h)=\pi\,(R_0/H)^2\,h^2\). Derivamos la soluci√≥n cerrada
    \(h(t)=\big(h_0^{5/2}-\tfrac{5}{2}\tfrac{aH^2}{\pi R_0^2}\sqrt{2g}\,t\big)^{2/5}\)
    y el tiempo de vaciado \(T\).
    <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
      data-bs-title="<strong>M√âTODO ANAL√çTICO VS NUM√âRICO</strong><br><br><strong>Ventajas del anal√≠tico:</strong><br>‚Ä¢ Soluci√≥n exacta<br>‚Ä¢ F√≥rmula cerrada<br>‚Ä¢ Entendimiento f√≠sico completo<br><br><strong>Limitaciones:</strong><br>‚Ä¢ Solo para geometr√≠as simples<br>‚Ä¢ Requiere integraci√≥n exacta posible">
      üí° Comparaci√≥n de m√©todos
    </span>
  </p>

  <div class="row g-3 align-items-stretch mb-4">
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="text-secondary mb-3">
            Par√°metros del modelo (cono perfecto)
            <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
              data-bs-title="<strong>GEOMETR√çA DEL CONO PERFECTO</strong><br><br>En un cono perfecto el radio crece linealmente con h:<br>\\[ R(h) = \\frac{R_0}{H} h \\]<br><br>Esto implica que el √°rea transversal crece con h¬≤:<br>\\[ A(h) = \\pi R(h)^2 = \\pi \\left(\\frac{R_0}{H}\\right)^2 h^2 \\]">
              ‚ìò
            </span>
          </h6>

          <div class="param-grid">
            <div>
              <label class="form-label">a (m¬≤) ‚Äî √°rea del orificio</label>
              <input type="number" step="any" class="form-control" id="parama" value="0.001">
            </div>

            <div>
              <label class="form-label">g (m/s¬≤)</label>
              <input type="number" step="any" class="form-control" id="paramg" value="9.8">
            </div>

            <div>
              <label class="form-label">h‚ÇÄ (m)</label>
              <input type="number" step="any" class="form-control" id="paramh0" value="1.0">
            </div>

            <div>
              <label class="form-label">R‚ÇÄ (m) ‚Äî radio de la boca</label>
              <input type="number" step="any" class="form-control" id="paramR0" value="0.4">
            </div>

            <div>
              <label class="form-label">H (m) ‚Äî altura total</label>
              <input type="number" step="any" class="form-control" id="paramH" value="1.0">
            </div>

            <div class="full">
              <label class="form-label">N (puntos de discretizaci√≥n)</label>
              <input type="number" step="1" min="50" class="form-control" id="paramN" value="600">
            </div>
          </div>

          <div class="mt-3 d-flex justify-content-between align-items-center">
            <button class="btn btn-outline-secondary btn-sm" id="reset" type="button">Restablecer</button>
            <span class="badge bg-primary fs-6">
              \(T\) = <span id="tvac">‚Äî</span>
              <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
                data-bs-title="<strong>TIEMPO DE VACIADO - INTERPRETACI√ìN F√çSICA</strong><br><br>\\[ T = \\frac{2\\pi R_0^2}{5aH^2\\sqrt{2g}} h_0^{5/2} \\]<br><br><strong>Dependencias:</strong><br>‚Ä¢ <strong>‚àù R‚ÇÄ¬≤:</strong> Cono m√°s ancho ‚Üí m√°s tiempo<br>‚Ä¢ <strong>‚àù 1/a:</strong> Orificio m√°s peque√±o ‚Üí m√°s tiempo<br>‚Ä¢ <strong>‚àù h‚ÇÄ¬≤¬∑‚Åµ:</strong> Altura inicial mayor ‚Üí mucho m√°s tiempo<br><br>El exponente 2.5 refleja la no-linealidad del sistema.">
                ‚ìò
              </span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="text-secondary mb-3">
            Evoluci√≥n temporal \(h(t)\)
            <span class="tt" data-bs-toggle="tooltip" data-bs-html="true"
              data-bs-title="<strong>CARACTER√çSTICAS DE LA CURVA h(t)</strong><br><br>\\[ h(t) = \\left(h_0^{5/2} - \\frac{5}{2}C t\\right)^{2/5} \\]<br><br><strong>Comportamiento:</strong><br>‚Ä¢ <strong>Decaimiento no-lineal:</strong> M√°s r√°pido al inicio<br>‚Ä¢ <strong>Derivada infinita en t=T:</strong> h'(T) ‚Üí -‚àû<br>‚Ä¢ <strong>Forma c√≥ncava:</strong> Refleja el √°rea decreciente<br><br>Esto contrasta con el cilindro donde h(t) es cuadr√°tico.">
              ‚ìò
            </span>
          </h6>

          <canvas id="chart" height="120"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-2">
    <h6 class="mb-0 text-secondary">C√≥digo Python con anotaciones</h6>
    <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#explicacionModal">
      Ver explicaci√≥n del m√©todo
    </button>
  </div>

  <div class="code-wrap mb-4">
    <button class="copy-btn" id="copy" type="button">Copiar c√≥digo</button>
    <pre class="code"><code id="code-block"></code></pre>
  </div>
</div>

<!-- ===== Modal de explicaci√≥n ===== -->
<div class="modal fade" id="explicacionModal" tabindex="-1" aria-labelledby="explicacionLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="explicacionLabel">De continuidad + Torricelli a \(h(t)\) en un cono perfecto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body">
        <h6>1. Fundamentos F√≠sicos</h6>
        <p><strong>Ecuaci√≥n de Torricelli:</strong> \( v = \sqrt{2gh} \)</p>
        <p><strong>Caudal de salida:</strong> \( Q = a \cdot v = a\sqrt{2gh} \)</p>
        
        <h6>2. Geometr√≠a del Cono</h6>
        <p>Radio a altura \(h\): \( R(h) = \dfrac{R_0}{H}h \)</p>
        <p>√Årea transversal: \( A(h) = \pi [R(h)]^2 = \pi \left(\dfrac{R_0}{H}\right)^2 h^2 \)</p>
        
        <h6>3. Ecuaci√≥n Diferencial</h6>
        <p>Por conservaci√≥n de masa: \( A(h)\dfrac{dh}{dt} = -Q \)</p>
        <p>\[ \pi \left(\dfrac{R_0}{H}\right)^2 h^2 \dfrac{dh}{dt} = -a\sqrt{2gh} \]</p>
        
        <h6>4. Separaci√≥n de Variables</h6>
        <p>Reordenamos: \( h^{3/2} dh = -\dfrac{aH^2}{\pi R_0^2}\sqrt{2g} dt \)</p>
        <p>Definimos constante: \( C = \dfrac{aH^2}{\pi R_0^2}\sqrt{2g} \)</p>
        <p>\[ h^{3/2} dh = -C dt \]</p>
        
        <h6>5. Integraci√≥n</h6>
        <p>Integramos ambos lados:</p>
        <p>\[ \int_{h_0}^{h} \xi^{3/2} d\xi = -C \int_0^t d\tau \]</p>
        <p>\[ \left[\frac{2}{5}\xi^{5/2}\right]_{h_0}^{h} = -C t \]</p>
        <p>\[ \frac{2}{5}(h^{5/2} - h_0^{5/2}) = -C t \]</p>
        
        <h6>6. Soluci√≥n Final</h6>
        <p>Despejando \(h(t)\):</p>
        <p>\[ h^{5/2} = h_0^{5/2} - \frac{5}{2}C t \]</p>
        <p>\[ h(t) = \left(h_0^{5/2} - \frac{5}{2}C t\right)^{2/5} \]</p>
        
        <h6>7. Tiempo de Vaciado</h6>
        <p>Cuando \(h(T) = 0\):</p>
        <p>\[ 0 = h_0^{5/2} - \frac{5}{2}C T \]</p>
        <p>\[ T = \frac{2}{5C} h_0^{5/2} = \frac{2\pi R_0^2}{5aH^2\sqrt{2g}} h_0^{5/2} \]</p>

        <div class="alert alert-info small">
          <strong>Nota importante:</strong> El exponente 5/2 (2.5) surge naturalmente de la integraci√≥n y refleja 
          la combinaci√≥n de la geometr√≠a c√≥nica (A ‚àù h¬≤) con la din√°mica de Torricelli (v ‚àù ‚àöh).
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}